  - name: Distribution
    debug: msg="{{ ansible_distribution }}"
  - name: First run
    debug: msg="{{ firstrun }}"
  #  debug: msg="{{ ansible_default_ipv4 }}"
  
#  - name: copy dotfiles.tar to other systems
#    copy:
#      remote_src: false
#      src: /home/mdries/dotfiles.tar
#      dest: /tmp/ 
#------ mdries ---------------
#------ Clean up first -------
  - name: chown mdries
    become: true
    file:
      path: /home/mdries
      state: directory
      recurse: yes
      owner: mdries
      group: mdries
    when: ansible_distribution != 'Alpine'
        
  - name: clean gitfiles
    file:
      path: /home/mdries/.git
      state: absent
    when: ansible_distribution != 'Alpine'

  - name: clean .zshrc			
    file:
      path: /home/mdries/.zshrc
      state: absent
    when: ansible_distribution != 'Alpine'

  - name: clean .vimrc
    file:
      path: /home/mdries/.vimrc
      state: absent
    when: ansible_distribution != 'Alpine'

  - name: clean .config
    file:
      path: /home/mdries/.config
      state: absent
    when: ansible_distribution != 'Alpine'

  - name: clean .local
    file:
      path: /home/mdries/.local
      state: absent
    when: ansible_distribution != 'Alpine'

  - name: clean .cache
    file:
      path: /home/mdries/.cache
      state: absent
    when: ansible_distribution != 'Alpine'

  - name: clean .oh-my-zsh
    file:
      path: /home/mdries/.oh-my-zsh
      state: absent
    when: ansible_distribution != 'Alpine'

  - name: clean .zshrc.old
    file:
      path: /home/mdries/.zshrc.old
      state: absent
    when: ansible_distribution != 'Alpine'

  - name: clean .zshrc.stock
    file:
      path: /home/mdries/.zshrc.stock
      state: absent
    when: ansible_distribution != 'Alpine'

  - name: clean ssh-config
    file:
      path: /home/mdries/ssh-config
      state: absent
    when: ansible_distribution != 'Alpine'

  - name: clean dotfiles
    file:
      path: /home/mdries/dotfiles
      state: absent
    when: ansible_distribution != 'Alpine'

#----- extract dotfiles.tar ------

#  - name: extract dotfiles
#    unarchive:
#      src: /tmp/dotfiles.tar
#      dest: /home/mdries/
#      remote_src: true

#------- copy dotfiles -----------

#  - name: mdries copy .oh-my-zsh
#    copy:
#      src: /home/mdries/src_dot_files/.oh-my-zsh/
#      dest: /home/mdries/.oh-my-zsh/
#      remote_src: false

#----------Alpine----------
  - name: first time  download oh-my-zsh
   # become: true
   # become_user: root
    get_url:
      url: https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh
      dest: /tmp/install_ohmyzsh.sh
      mode: 0755
    when: ansible_distribution == 'Alpine' and firstrun == true

  - name: first time root Run Oh My Zsh installation script
#    become: true
#    become_user: root
    command: sh /tmp/install_ohmyzsh.sh --unattended
    register: ohmyzsh_result
    failed_when: "'FAILED' in ohmyzsh_result.stderr"
    when: ansible_distribution == 'Alpine' and firstrun == true

  - name: root copy .zshrc
    copy:
      remote_src: false
      src: /home/mdries/src_dot_files/.zshrc
      dest: /root
    when: ansible_distribution == 'Alpine' and firstrun == true

  - name: root create neofetch/config
    file:
      path: /root/.config/neofetch/
      state: directory
    when: ansible_distribution == 'Alpine' and firstrun == true

  - name: root copy neofetch/config
    copy:
      remote_src: false
      src: /home/mdries/src_dot_files/neofetch/config.conf
      dest: /root/.config/neofetch/
    when: ansible_distribution == 'Alpine' and firstrun == true

  - name: root create helix/config
    file:
      path: /root/.config/helix/
      state: directory
    when: ansible_distribution == 'Alpine' and firstrun == true

  - name: root copy helix/config
    copy:
      remote_src: false
      src: /home/mdries/src_dot_files/helix/config.toml
      dest: /root/.config/helix/
    when: ansible_distribution == 'Alpine' and firstrun == true


#  - name: first time mdries download oh-my-zsh
#    become: true
#    become_user: mdries
#    get_url:
#      url: https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh
#      dest: /home/mdries/install_ohmyzsh.sh
#      mode: 0755
#    when: ansible_distribution == 'Alpine' and firstrun == true

  - name: first time mdries Run Oh My Zsh installation script
    become: true
    become_method: doas
    become_user: mdries
    command: sh /tmp/install_ohmyzsh.sh --unattended
    args:
      chdir: /home/mdries
    register: ohmyzsh_result
    failed_when: "'FAILED' in ohmyzsh_result.stderr"
    when: ansible_distribution == 'Alpine' and firstrun == true

  - name: mdries copy .zshrc
    become: true
    become_method: doas
    become_user: mdries
    copy:
      remote_src: false
      src: /home/mdries/src_dot_files/.zshrc
      dest: /home/mdries
    when: ansible_distribution == 'Alpine' and firstrun == true

  - name: mdries create neofetch/config
    become: true
    become_method: doas
    become_user: mdries
    file:
      path: /home/mdries/.config/neofetch/
      state: directory
    when: ansible_distribution == 'Alpine' and firstrun == true

  - name: mdries copy neofetch/config
    become: true
    become_method: doas
    become_user: mdries
    copy:
      remote_src: false
      src: /home/mdries/src_dot_files/neofetch/config.conf
      dest: /home/mdries/.config/neofetch/
    when: ansible_distribution == 'Alpine' and firstrun == true


  - name: mdries create helix/config
    become: true
    become_method: doas
    become_user: mdries
    file:
      path: /home/mdries/.config/helix/
      state: directory
    when: ansible_distribution == 'Alpine' and firstrun == true

  - name: mdries copy helix/config
    become: true
    become_method: doas
    become_user: mdries
    copy:
      remote_src: false
      src: /home/mdries/src_dot_files/helix/config.toml
      dest: /home/mdries/.config/helix/
    when: ansible_distribution == 'Alpine' and firstrun == true


#---------not first time-------------------
  - name: root download oh-my-zsh
    become: true
    become_method: doas
    become_user: root
    get_url:
      url: https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh
      dest: /tmp/install_ohmyzsh.sh
      mode: 0755
    when: ansible_distribution == 'Alpine' and firstrun == false

  - name: root Run Oh My Zsh installation script
    become: true
    become_method: doas
    become_user: root
    command: sh /tmp/install_ohmyzsh.sh --unattended
    register: ohmyzsh_result
    failed_when: "'FAILED' in ohmyzsh_result.stderr"
    when: ansible_distribution == 'Alpine' and firstrun == false

  - name: mdries Run Oh My Zsh installation script
    command: sh /tmp/install_ohmyzsh.sh --unattended
    register: ohmyzsh_result
    failed_when: "'FAILED' in ohmyzsh_result.stderr"
    when: ansible_distribution == 'Alpine' and firstrun == false


#  - name: mdries download oh-my-zsh
   # become: true
   # become_user: root
#    get_url:
#      url: https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh
#      dest: /home/mdries/install_ohmyzsh.sh
#      mode: 0755
#    when: ansible_distribution == 'Alpine' and firstrun == false




  
#  - name: chown mdries
#    become: true
#    file:
#      path: /home/mdries
#      state: directory
#      recurse: yes
#      owner: mdries
#      group: mdries
  
#------ root ---------------
#------ Clean up first -------
#  - name: chown root regular hosts
#    become: true
#    file:
#      path: /root
#      state: directory
#      recurse: yes
#      owner: root
#      group: root
    #when: ansible_hostname != 'pve' or ansible_hostname != 'hopperspve'
#    when: inventory_hostname in groups['normal']
      
#  - name: chown root pve .vimrc
#    become: true
#    file:
#      path: /root/.vimrc
#      state: file
#      owner: root
#      group: root
#    when: inventory_hostname in groups['pve']    

#  - name: chown root pve .oh-my-zsh
#    become: true
#    file:
#      path: /root/.oh-my-zsh
#      state: directory
#      recurse: yes
#      owner: root
#      group: root
#    when: inventory_hostname in groups['pve']    

  - name: root clean gitfiles
    become: true
    file:
      path: /root/.git
      state: absent
    when: ansible_distribution != 'Alpine'

  - name: root clean .zshrc
    become: true
    file:
      path: /root/.zshrc
      state: absent
    when: ansible_distribution != 'Alpine'

  - name: root clean .vimrc
    become: true
    file:
      path: /root/.vimrc
      state: absent
    when: ansible_distribution != 'Alpine'

  - name: root clean .config
    become: true
    file:
      path: /root/.config
      state: absent
    when: ansible_distribution != 'Alpine'

  - name: root clean .local
    become: true
    file:
      path: /root/.local
      state: absent
    when: ansible_distribution != 'Alpine'

  - name: root clean .cache
    become: true
    file:
      path: /root/.cache
      state: absent
    when: ansible_distribution != 'Alpine'

  - name: root clean .on-my-zsh
    become: true
    file:
      path: /root/.oh-my-zsh
      state: absent
    when: ansible_distribution != 'Alpine'

  - name: root clean .zshrc.old
    become: true
    file:
      path: /root/.zshrc.old
      state: absent
    when: ansible_distribution != 'Alpine'

  - name: root clean .zshrc.stock
    become: true
    file:
      path: /root/.zshrc.stock
      state: absent
    when: ansible_distribution != 'Alpine'

  - name: root clean ssh-config
    become: true
    file:
      path: /root/ssh-config
      state: absent
    when: ansible_distribution != 'Alpine'

  - name: root clean dotfiles
    become: true
    file:
      path: /root/dotfiles
      state: absent
    when: ansible_distribution != 'Alpine'

  - name: root Run Oh My Zsh installation script
    become: true
    command: sh /tmp/install_ohmyzsh.sh --unattended
    register: ohmyzsh_result
    failed_when: "'FAILED' in ohmyzsh_result.stderr"
    when: ansible_distribution != 'Alpine'

  - name: root copy .zshrc
    become: true
    copy:
      remote_src: false
      src: /home/mdries/src_dot_files/.zshrc
      dest: /root/
    when: ansible_distribution != 'Alpine'


  - name: root copy neofetch/config
    become: true
    copy:
      remote_src: false
      src: /home/mdries/src_dot_files/neofetch/config.conf
      dest: /root/.config/neofetch/
    when: ansible_distribution != 'Alpine'


#----- extract dotfiles.tar ------

#  - name: root extract dotfiles
#    become: true
#    unarchive:
#      src: /tmp/dotfiles.tar
#      dest: /root/
#      remote_src: true
      
#  - name: chown root regular hosts
#    become: true
#    file:
#      path: /root
#      state: directory
#      recurse: yes
#      owner: root
#      group: root
    #when: ansible_hostname != 'pve' or ansible_hostname != 'hopperspve'
#    when: inventory_hostname in groups['normal']
      
#  - name: find root files pve
#    become: true
#    find: 
#      paths: /root
#      excludes: '.ssh'
#    register: files_to_fix
    #when: ansible_hostname == 'pve' or ansible_hostname == 'hopperspve'
#    when: inventory_hostname in groups['pve']

#  - name: chown root pve .zshrc
#    become: true
#    file:
#      path: /root/.zshrc
#      state: file
#      owner: root
#      group: root
#    when: inventory_hostname in groups['pve']    
